<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: Object</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>

</head>
<body class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./lib/app_controller_client_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/app_controller_client.rb">lib/app_controller_client.rb</a></li>
          
            <li><a href="./lib/babel_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/babel.rb">lib/babel.rb</a></li>
          
            <li><a href="./lib/neptune_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/neptune.rb">lib/neptune.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"></p>
        
      </div>
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-babel">#babel</a></li>
          
          <li><a href="#method-i-neptune">#neptune</a></li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./AppControllerClient.html">AppControllerClient</a></li>
        
          <li><a href="./AppControllerException.html">AppControllerException</a></li>
        
          <li><a href="./BabelHelper.html">BabelHelper</a></li>
        
          <li><a href="./BadConfigurationException.html">BadConfigurationException</a></li>
        
          <li><a href="./CommonFunctions.html">CommonFunctions</a></li>
        
          <li><a href="./FileNotFoundException.html">FileNotFoundException</a></li>
        
          <li><a href="./NeptuneHelper.html">NeptuneHelper</a></li>
        
          <li><a href="./Object.html">Object</a></li>
        
          <li><a href="./TaskInfo.html">TaskInfo</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Object</h1>

    <div id="description">
      
<p>Since we’re monkeypatching <a href="Object.html">Object</a> to add
neptune() and babel(), a short blurb is necessary here to make rdoc happy.</p>

    </div>

    <!-- Constants -->
    
    <div id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt><a name="NO_TIMEOUT">NO_TIMEOUT</a></dt>
        
        <dd class="description"><p>Sometimes SOAP calls take a long time if large amounts of data are being
sent over the network: for this first version we don’t want these calls
to endlessly timeout and retry, so as a hack, just don’t let them
timeout. The next version should replace this and properly timeout and not
use long calls unless necessary.</p></dd>
        
      
        <dt><a name="NEEDS_BUCKET_INFO">NEEDS_BUCKET_INFO</a></dt>
        
        <dd class="description"><p>If the user doesn’t give us enough info to infer what bucket we should
place their code in, this message is displayed and execution aborts.</p></dd>
        
      
        <dt><a name="DOES_NOT_EXIST">DOES_NOT_EXIST</a></dt>
        
        <dd class="description"><p>The constant string that a Neptune output job returns if the output does
not yet exist.</p></dd>
        
      
        <dt><a name="SLEEP_TIME">SLEEP_TIME</a></dt>
        
        <dd class="description"><p>The initial amount of time, in seconds, to sleep between output job
requests. An exponential backoff is used with this value as the starting
sleep time.</p></dd>
        
      
        <dt><a name="MAX_SLEEP_TIME">MAX_SLEEP_TIME</a></dt>
        
        <dd class="description"><p>The maximum amount of time that we should sleep to, when waiting for output
job requests.</p></dd>
        
      
        <dt><a name="ALLOWED_JOB_TYPES">ALLOWED_JOB_TYPES</a></dt>
        
        <dd class="description"><p>A list of all the Neptune job types that we support</p></dd>
        
      
        <dt><a name="JOB_TYPE_NOT_ALLOWED">JOB_TYPE_NOT_ALLOWED</a></dt>
        
        <dd class="description"><p>The string to display for disallowed job types.</p></dd>
        
      
        <dt><a name="NO_NODES_NEEDED">NO_NODES_NEEDED</a></dt>
        
        <dd class="description"><p>A list of Neptune jobs that do not require nodes to be spawned up for
computation</p></dd>
        
      
        <dt><a name="NO_OUTPUT_NEEDED">NO_OUTPUT_NEEDED</a></dt>
        
        <dd class="description"><p>A list of Neptune jobs that do not require the output to be specified
beforehand</p></dd>
        
      
        <dt><a name="ALLOWED_STORAGE_TYPES">ALLOWED_STORAGE_TYPES</a></dt>
        
        <dd class="description"><p>A list of storage mechanisms that we can use to store and retrieve data to
for Neptune jobs.</p></dd>
        
      
        <dt><a name="NEED_PREPROCESSING">NEED_PREPROCESSING</a></dt>
        
        <dd class="description"><p>A list of jobs that require some kind of work to be done before the actual
computation can be performed.</p></dd>
        
      
      </dl>
    </div>
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-instance-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="babel-method" class="method-detail ">
        <a name="method-i-babel"></a>

        
        <div class="method-heading">
          <span class="method-name">babel</span><span
            class="method-args">(params)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Babel provides a nice wrapper around Neptune jobs. Instead of making users
write multiple Neptune jobs to actually run code (e.g., putting input in
the datastore, run the job, get the output back), Babel automatically
handles this.</p>
          

          
          <div class="method-source-code"
            id="babel-source">
<pre>
<span class="ruby-comment"># File lib/babel.rb, line 44</span>
def babel(params)
  <span class="ruby-comment"># Since this whole function should run asynchronously, we run it as a future.</span>
  <span class="ruby-comment"># It automatically starts running in a new thread, and attempting to get the</span>
  <span class="ruby-comment"># value of what this returns causes it to block until the job completes.</span>
  future {
    if params[:storage]
      params[:is_remote] = true
    else
      params[:is_remote] = false
    end

    job_data = <span class="ruby-constant">BabelHelper</span>.convert_from_neptune_params(params)

    <span class="ruby-constant">NeptuneHelper</span>.validate_storage_params(job_data)  <span class="ruby-comment"># adds in S3 storage params</span>

    <span class="ruby-comment"># :code is the only required parameter - everything else can use default vals</span>
    <span class="ruby-constant">NeptuneHelper</span>.require_param(<span class="ruby-string">&quot;@code&quot;</span>, job_data)
    <span class="ruby-constant">BabelHelper</span>.check_output_files(job_data)

    if job_data[<span class="ruby-string">&quot;@is_remote&quot;</span>]
      <span class="ruby-constant">BabelHelper</span>.validate_inputs(job_data)
    else
      <span class="ruby-constant">BabelHelper</span>.put_code(job_data)
      <span class="ruby-constant">BabelHelper</span>.put_inputs(job_data)
    end

    <span class="ruby-constant">BabelHelper</span>.run_job(job_data)

    <span class="ruby-comment"># Return an object to the user that has all the information about their</span>
    <span class="ruby-comment"># task, including its standard out, err, debugging info, and profiling</span>
    <span class="ruby-comment"># info. Since the job may not be done when the user asks for this info,</span>
    <span class="ruby-comment"># its the responsibility of TaskInfo objects to block until that info</span>
    <span class="ruby-comment"># is ready. We don't explicitly return the TaskInfo object, because it's</span>
    <span class="ruby-comment"># in a Future block - it will automatically return whatever the last</span>
    <span class="ruby-comment"># statement returns.</span>
    <span class="ruby-constant">TaskInfo</span>.new(job_data)
  }
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="neptune-method" class="method-detail ">
        <a name="method-i-neptune"></a>

        
        <div class="method-heading">
          <span class="method-name">neptune</span><span
            class="method-args">(params)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This method is the heart of Neptune - here, we take blocks of code that the
user has written and convert them into HPC job requests. At a high level, 
the user can request to run a job, retrieve a job’s output, or modify the
access policy (ACL) for the output of a job. By default, job data is
private, but a Neptune job can be used to set it to public later (and
vice-versa).</p>
          

          
          <div class="method-source-code"
            id="neptune-source">
<pre>
<span class="ruby-comment"># File lib/neptune.rb, line 58</span>
def neptune(params)
  <span class="ruby-comment"># Kernel.puts &quot;Received a request to run a job.&quot;</span>
  <span class="ruby-comment"># Kernel.puts params[:type]</span>

  job_data = <span class="ruby-constant">NeptuneHelper</span>.get_job_data(params)
  <span class="ruby-constant">NeptuneHelper</span>.validate_storage_params(job_data)
  <span class="ruby-comment"># Kernel.puts &quot;job data = #{job_data.inspect}&quot;</span>
  keyname = job_data[<span class="ruby-string">&quot;@keyname&quot;</span>]

  shadow_ip = <span class="ruby-constant">CommonFunctions</span>.get_from_yaml(keyname, :shadow)
  secret = <span class="ruby-constant">CommonFunctions</span>.get_secret_key(keyname)
  ssh_key = <span class="ruby-constant">File</span>.expand_path(&quot;~/.appscale/#{keyname}.key&quot;)
  ssh_args = &quot;-i ~/.appscale/#{keyname}.key -o StrictHostkeyChecking=no &quot;

  controller = <span class="ruby-constant">AppControllerClient</span>.new(shadow_ip, secret)
  <span class="ruby-constant">NeptuneHelper</span>.do_preprocessing(job_data, controller) 
  return <span class="ruby-constant">NeptuneHelper</span>.run_job(job_data, ssh_args, shadow_ip, secret)
end</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </div>
  

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

